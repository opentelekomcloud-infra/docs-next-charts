replicas: 5
image: quay.io/opentelekomcloud/docs-next
tag: 20250321.31.0-9295654
ingress:
  host:
  clusterIssuer: letsencrypt-prod

oauth2-proxy:
  enabled: true
  image:
    repository: quay.io/oauth2-proxy/oauth2-proxy
    tag: v7.8.1
  config:
    existingSecret: ""
    configFile: |-
      provider = "oidc"
      oidc_issuer_url = "https://keycloak.eco.tsi-dev.otc-service.com/realms/eco"
      redirect_url = "https://{{ .Values.ingress.host }}"
      email_domains = ["*"]
      upstreams = ["file:///dev/null"]
      whitelist_domains = "{{ .Values.ingress.host }}"
      cookie_domains = "{{ .Values.ingress.host }}"
  podAnnotations:
    vault.hashicorp.com/auth-path: "auth/kubernetes_otcinfra1"
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/agent-inject-secret-oauth-config: "secret/data/docs-next/stg"
    vault.hashicorp.com/role: "docs-next"
    vault.hashicorp.com/agent-pid-file: "/home/vault/pidfile"
    vault.hashicorp.com/agent-inject-config-apiproxy: |
      api_proxy {
        use_auto_auth_token = "force"
        enforce_consistency = "always"
      }
    vault.hashicorp.com/agent-inject-template-oauth-config: |
      {{`{{- with secret "secret/data/docs-next/stg" -}}`}}
      OAUTH2_PROXY_CLIENT_ID={{ .Data.data.client_id }}
      OAUTH2_PROXY_CLIENT_SECRET={{ .Data.data.client_secret }}
      OAUTH2_PROXY_COOKIE_SECRET={{ .Data.data.cookie_secret }}
      {{`{{- end }}`}}
  command:
    - /bin/sh
    - -c
    - |
      source /vault/secrets/oauth-config
      exec /oauth2-proxy --config=/etc/oauth2-proxy/oauth2-proxy.conf
  serviceAccount:
    name: docusaurus-stg-oauth2-proxy
  metrics:
    serviceMonitor:
      enabled: true
