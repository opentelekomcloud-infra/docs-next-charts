replicas: 5
image: quay.io/opentelekomcloud/docs-next
tag: 20250321.31.0-9295654
ingress:
  host:
  clusterIssuer: letsencrypt-prod

oauth2-proxy:
  enabled: true
  image:
    repository: quay.io/oauth2-proxy/oauth2-proxy
    tag: v7.8.1
  podAnnotations:
    vault.hashicorp.com/auth-path: "auth/kubernetes_otcinfra1"
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: "docs-next"
    vault.hashicorp.com/agent-pid-file: "/home/vault/pidfile"
    vault.hashicorp.com/agent-inject-config-apiproxy: |
      api_proxy {
        use_auto_auth_token = "force"
        enforce_consistency = "always"
      }
    vault.hashicorp.com/agent-inject-template-oauth-config.conf: |
      provider = "oidc"
      oidc_issuer_url = "https://keycloak.eco.tsi-dev.otc-service.com/realms/eco"
      redirect_url = "https://arch-stg.otc-service.com/oauth2/callback"
      email_domains = ["*"]
      upstreams = ["http://docusaurus-stg-docs-next-docusaurus"]
      insecure_oidc_allow_unverified_email = true
      whitelist_domains = "https://arch-stg.otc-service.com/"
      cookie_domains = "https://arch-stg.otc-service.com/"
      allowed_groups = ["/docs-next",]
      {{- with secret "secret/data/docs-next/stg" }}
      cookie_secret = "{{ .Data.data.client_cookie }}"
      client_id = "{{ .Data.data.client_id }}"
      client_secret = "{{ .Data.data.client_secret }}"
      {{- end }}
  extraArgs:
    - --config=/vault/secrets/oauth-config.conf
  serviceAccount:
    name: docusaurus-stg-oauth2-proxy
  metrics:
    serviceMonitor:
      enabled: true
  proxyVarsAsSecrets: false
  config:
    configFile: ""
